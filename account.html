<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Account – Starplanner</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@400;600;700&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
<style>
/* ==== Basiskleuren ==== */
:root{
  --mandarin:#FFB84C;           /* mandarijn-oranje (stroke) */
  --mandarin-deep:#FFA040;
  --light-yellow:#FFF7B2;       /* lichtgeel (fill) */
  --cream:#FFFDF6;
  --gold-stroke:#FFE9A6;
  --btn:#FFC04D;
  --btn-hover:#EAA23D;
  --salmon:#FF9A6A;
  --salmon-hover:#FF864F;
}
*{box-sizing:border-box}
body{font-family:'Montserrat Alternates',sans-serif;margin:0;background:#fff;}
nav{background-image:url('ArtworkWaterverfkwastachterkopjes.jpg');background-repeat:no-repeat;background-position:center;background-size:120% 110%;padding:40px 60px;display:flex;justify-content:space-between;align-items:center;}
nav ul{list-style:none;margin:0;padding:0;display:flex;gap:70px;padding-left:100px;}
nav ul li a{text-decoration:none;color:white;font-size:18px;font-weight:600;text-shadow:1px 1px 3px rgba(0,0,0,0.3);}
nav ul li a:hover{color:#FF7929;}
.nav-icons{display:flex;gap:30px;align-items:center;}
.nav-icons img{width:36px;height:36px;cursor:pointer;}
.cart-link{position:relative;}
.cart-badge{position:absolute;top:-6px;right:-6px;background:#FF6F61;color:#fff;font-size:12px;font-weight:600;padding:2px 6px;border-radius:50%;min-width:18px;text-align:center;}

main{max-width:1100px;margin:60px auto;padding:0 20px;}
.account-shell{display:grid;grid-template-columns:260px 1fr;gap:24px;}
.sidebar{background:var(--cream);border-radius:18px;padding:24px;box-shadow:0 4px 12px rgba(0,0,0,.06);text-align:center;}
.avatar{
  width:120px;height:120px;border-radius:50%;margin:0 auto 18px;position:relative;
  background:linear-gradient(145deg,#FFFBEA,#FFE39C);
  border:4px solid #FFA94D;display:flex;align-items:center;justify-content:center;
  box-shadow:0 4px 10px rgba(255,170,70,0.25);overflow:hidden;transition:transform .18s ease;
}
.avatar:hover{ transform:scale(1.04); }
.avatar svg{width:65px;height:65px;fill:#FFB766;transition:opacity .2s;}
.avatar.has-photo svg{opacity:0;}
.avatar img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:none;}
.avatar.has-photo img{display:block;}

/* Wit 3D plusje – zonder knopachtergrond, alleen het plus-symbool */
.plus-btn{
  position:absolute;inset:0;margin:auto;width:40px;height:40px;border:none;background:transparent;cursor:pointer;
  display:flex;align-items:center;justify-content:center;z-index:2;
  transform:scale(1);transition:transform .14s ease;
}
.plus-btn:hover{ transform:scale(1.1); }
.plus-btn:before, .plus-btn:after{
  content:""; position:absolute; background:#ffffff; border-radius:2px;
  box-shadow:0 1px 0 rgba(0,0,0,.12), 0 4px 10px rgba(0,0,0,.15); /* 3D diepte */
}
.plus-btn:before{ width:70%; height:3px; }
.plus-btn:after{ height:70%; width:3px; }

/* Sidebar kop */
.side-title{
  font-family:'Playfair Display',serif;font-size:28px;font-weight:700;margin:0 0 20px;
  background:linear-gradient(90deg,#FFD974,#FFB84C);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;text-align:center;
}

/* Side navigatie */
.side-nav{display:flex;flex-direction:column;gap:8px;}
.side-nav button{background:none;border:none;padding:10px 14px;font-family:'Playfair Display',serif;font-size:18px;cursor:pointer;color:var(--mandarin);text-shadow:0 0 1px #FFE6A5;transition:color .2s;}
.side-nav button:hover,.side-nav button.active{color:var(--mandarin-deep);text-shadow:0 0 3px #FFE9A6;}
.logout-btn{
  width:100%;background:var(--salmon);color:#fff;border:none;border-radius:12px;padding:14px 0;
  font-size:18px;font-family:'Montserrat Alternates',sans-serif;font-weight:600;letter-spacing:0.5px;text-transform:uppercase;
  text-shadow:1px 1px 3px rgba(0,0,0,0.25);margin-top:20px;cursor:pointer;box-shadow:0 4px 8px rgba(255,160,110,0.3);
  transition:background .25s ease, transform .15s ease;
}
.logout-btn:hover{ background:var(--salmon-hover); transform:translateY(-1px); }

.content{background:var(--cream);border-radius:18px;padding:40px;box-shadow:0 6px 12px rgba(0,0,0,0.05);}

/* Sectietitel – standaard (incl. Home, met gradient) */
.section-title{
  font-family:'Playfair Display',serif;font-size:26px;
  background:linear-gradient(90deg,#FFD974,#FFB84C);
  -webkit-background-clip:text;-webkit-text-stroke:1px var(--gold-stroke);-webkit-text-fill-color:transparent;
  margin:0 0 14px;
}
/* Actieve pagina (niet-Home): binnenkant lichtgeel, rand mandarijn-oranje */
.section-title.active{
  background:none;
  -webkit-text-fill-color:var(--light-yellow);
  -webkit-text-stroke:1.2px var(--mandarin);
}

/* Orders */
.orders p{color:#FFAE42;font-family:'Playfair Display';font-size:17px;}
.order{background:#FFF8D8;border:2px solid var(--mandarin);border-radius:12px;padding:14px;margin-bottom:12px;}
.order h4{margin:0 0 8px;color:#FFAE42;font-family:'Playfair Display';}

/* Knoppen & inputs */
.btn{display:inline-block;background:var(--btn);color:#fff;border:none;border-radius:10px;padding:12px 18px;cursor:pointer;font-weight:600;font-family:'Montserrat Alternates';transition:transform .1s ease, background .2s ease;box-shadow:0 4px 8px rgba(0,0,0,.05);}
.btn:hover{background:var(--btn-hover);transform:translateY(-1px);}
input,select{width:100%;padding:10px;border:2px solid #FFD46A;border-radius:10px;font-size:15px;font-family:'Montserrat Alternates';margin-bottom:10px;background:#fff;}
input[disabled], select[disabled]{background:#f7f3e7;color:#8b816d;border-style:dashed;}
.actions-row{display:flex;gap:12px;align-items:center;margin-top:6px;}

/* Welcome – behoud ombre, voeg klassieke 3D diepte toe */
.welcome-area{text-align:center;margin-bottom:40px;}
.welcome-area h1{
  font-family:'Playfair Display',serif;font-size:64px;letter-spacing:0.5px;margin:0;font-weight:700;
  background:linear-gradient(90deg,#FFF7B2,#FFB85C);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  /* 3D: subtiele stacking (klassiek, niet speels) */
  text-shadow:
    0 1px 0 #e6c985,
    0 2px 0 #dbb86f,
    0 3px 0 #d0a85a,
    0 6px 12px rgba(0,0,0,.18);
}

footer{position:relative;margin:60px 0 0;overflow:hidden;}
.footer-decoration{width:100%;height:100px;object-fit:cover;display:block;}
.footer-text{position:absolute;bottom:10px;width:100%;text-align:center;color:#fff;font-size:14px;text-shadow:1px 1px 3px rgba(0,0,0,0.5);}

/* Upload & Crop Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:9999;padding:20px;}
.modal.open{display:flex;}
.modal-card{width:min(720px,95vw);background:#fff;border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25);}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.modal-title{font-family:'Playfair Display',serif;font-size:22px}
.modal-close{border:none;background:transparent;font-size:26px;cursor:pointer;line-height:1}
.crop-area{position:relative;width:100%;aspect-ratio:1/1;background:#f3efe3;border-radius:14px;border:2px dashed #e2cf97;overflow:hidden;}
.crop-canvas{position:absolute;inset:0;cursor:grab}
.crop-canvas.dragging{cursor:grabbing}
.modal-controls{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-top:12px;flex-wrap:wrap}
.range{flex:1}
.note{font-size:12px;color:#6b6049}
.hidden{display:none!important}
</style>
</head>
<body>
<header>
  <nav>
    <ul>
      <li><a href="index.html">HOME</a></li>
      <li><a href="thestorybehind.html">THE STORY BEHIND</a></li>
      <li><a href="shop.html">SHOP</a></li>
      <li><a href="plannertips.html">PLANNER TIPS</a></li>
      <li><a href="contact.html">CONTACT</a></li>
    </ul>
    <div class="nav-icons">
      <a href="account.html"><img src="user-icon.svg" alt="User"></a>
      <a href="checkout.html" class="cart-link">
        <img src="shoppingbag.svg" alt="Shopping Bag">
        <span class="cart-badge" id="cart-count">0</span>
      </a>
    </div>
  </nav>
</header>

<main>
  <section id="account-section">
    <div class="account-shell">
      <aside class="sidebar">
        <div class="avatar" id="avatar">
          <img id="avatar-img" alt="Profile photo">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 12c2.76 0 5-2.24 5-5S14.76 2 12 2 7 4.24 7 7s2.24 5 5 5zm0 2c-4.33 0-8 2.17-8 5v1h16v-1c0-2.83-3.67-5-8-5z"/></svg>
          <button class="plus-btn" id="avatar-plus" title="Add/Change photo" aria-label="Add or change profile photo"></button>
        </div>
        <p class="side-title">My Account</p>
        <div class="side-nav">
          <button class="active" data-target="sec-welcome">Home</button>
          <button data-target="sec-orders">Orders</button>
          <button data-target="sec-addresses">Personal data & address</button>
          <button data-target="sec-security">Security</button>
          <button data-target="sec-preferences">Preferences</button>
          <button data-target="sec-returns">Returns</button>
        </div>
        <button class="logout-btn" onclick="logout()">SIGN OUT</button>
      </aside>

      <div class="content">
        <section id="sec-welcome">
          <div class="welcome-area">
            <h1 id="welcome-name">Welcome!</h1>
          </div>
        </section>

        <section id="sec-orders" style="display:none;">
          <h3 class="section-title">My Orders</h3>
          <div id="orders" class="orders"><p>No orders</p></div>
        </section>

        <section id="sec-addresses" style="display:none;">
          <h3 class="section-title">Personal data & address</h3>
          <form id="form-ship" class="grid-1" style="max-width:500px;">
            <input id="ship_name" placeholder="Full name" disabled>
            <input id="ship_line1" placeholder="Address line 1" disabled>
            <input id="ship_city" placeholder="City" disabled>
            <input id="ship_postal" placeholder="Postal code" disabled>
            <input id="ship_country" placeholder="Country" disabled>
            <div class="actions-row">
              <button type="button" class="btn" id="btn-edit">Edit</button>
              <button type="button" class="btn" id="btn-save" disabled>Save</button>
            </div>
          </form>
        </section>

        <section id="sec-security" style="display:none;">
          <h3 class="section-title">Security</h3>
          <div style="max-width:500px;">
            <input type="password" id="cur_pass" placeholder="Current password">
            <input type="password" id="new_pass" placeholder="New password">
            <input type="password" id="new_pass_repeat" placeholder="Repeat new password">
            <button type="button" class="btn" onclick="changePassword()">Update password</button>
          </div>
        </section>

        <section id="sec-preferences" style="display:none;">
          <h3 class="section-title">Preferences</h3>
          <label>Language</label>
          <select id="pref-lang">
            <option value="en">English</option>
            <option value="nl">Nederlands</option>
          </select>
          <label>Currency</label>
          <select id="pref-cur">
            <option value="EUR">EUR (€)</option>
            <option value="USD">USD ($)</option>
          </select>
        </section>

        <section id="sec-returns" style="display:none;">
          <h3 class="section-title">Returns</h3>
          <form id="form-return" style="max-width:500px;">
            <input id="ret_order" placeholder="Order ID">
            <input id="ret_reason" placeholder="Reason">
            <button type="button" class="btn" onclick="submitReturn()">Submit return</button>
          </form>
        </section>
      </div>
    </div>
  </section>
</main>

<footer>
  <img src="ArtworkWaterverfkwastfootheader.jpg" alt="Footer Decoration" class="footer-decoration">
  <div class="footer-text">© 2025 Starplanner – All rights reserved.</div>
</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-storage-compat.js"></script>

<!-- Upload & Crop Modal -->
<div class="modal" id="avatar-modal" aria-hidden="true" role="dialog" aria-label="Upload profile photo">
  <div class="modal-card">
    <div class="modal-header">
      <div class="modal-title">Upload & crop your profile photo</div>
      <button class="modal-close" id="crop-close" aria-label="Close">×</button>
    </div>
    <div class="crop-area">
      <canvas id="crop-canvas" class="crop-canvas"></canvas>
      <input type="file" id="file-input" accept="image/*" class="hidden">
    </div>
    <div class="modal-controls">
      <div>
        <button class="btn" id="btn-choose">Choose image</button>
        <button class="btn" id="btn-reset">Reset</button>
      </div>
      <label class="range">
        Zoom
        <input type="range" id="zoom" min="1" max="3" step="0.01" value="1" style="width:100%">
      </label>
      <div>
        <button class="btn" id="btn-save-crop">Save photo</button>
      </div>
    </div>
    <p class="note">Tip: drag the image to center your face. Only the square is saved.</p>
  </div>
</div>

<script>
/* ==== Firebase init ==== */
const firebaseConfig={
  apiKey:"AIzaSyApt-W5-Ag4Ov2JxVcudSrV4VL0zCBE8pc",
  authDomain:"starplanner-3acf9.firebaseapp.com",
  projectId:"starplanner-3acf9",
  storageBucket:"starplanner-3acf9.appspot.com",
  messagingSenderId:"793684440573",
  appId:"1:793684440573:web:5beb2ab6f64b4fc110d594"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();

/* ==== Auth: load orders & profile ==== */
auth.onAuthStateChanged(async user=>{
 if(user){
   document.getElementById('welcome-name').textContent=`Welcome, ${user.email.split('@')[0]}!`;
   await Promise.all([loadOrders(user.uid), loadProfile(user.uid)]);
 }
});

/* ==== Orders ==== */
async function loadOrders(userId){
  const ordersDiv=document.getElementById('orders');
  ordersDiv.innerHTML="<p>Loading your orders…</p>";
  try{
    const snap=await db.collection('orders')
      .where('userId','==',userId)
      .orderBy('date','desc')
      .get();

    if(snap.empty){
      ordersDiv.innerHTML="<p>No orders found.</p>";
      return;
    }
    ordersDiv.innerHTML="";
    snap.forEach(doc=>{
      const o=doc.data();
      const date=o.date?.toDate?o.date.toDate().toLocaleString():"Unknown date";
      const total=typeof o.total==='number'?o.total.toFixed(2):"0.00";
      const items=(o.items||[]).map(i=>`<li>${escapeHtml(i.name)} – €${(i.price??0).toFixed(2)} × ${i.qty??1}</li>`).join("");
      const block=document.createElement("div");
      block.className="order";
      block.innerHTML=`<h4>Order on ${date}</h4><ul>${items}</ul><p><strong>Total:</strong> €${total}</p>`;
      ordersDiv.appendChild(block);
    });
  }catch(err){
    console.error(err);
    ordersDiv.innerHTML="<p>Error loading orders.</p>";
  }
}

/* ==== Navigatie + actieve titelkleuren ==== */
document.querySelectorAll('.side-nav button').forEach(btn=>{
 btn.addEventListener('click',()=>{
   document.querySelectorAll('.side-nav button').forEach(b=>b.classList.remove('active'));
   btn.classList.add('active');
   const tgt=btn.getAttribute('data-target');
   document.querySelectorAll('.content>section').forEach(s=>{
     const show=(s.id===tgt);
     s.style.display= show ? 'block':'none';
     const title=s.querySelector('.section-title');
     if(title){
       if(s.id==='sec-welcome'){ title.classList.remove('active'); } // Home behoudt gradient
       else { title.classList.add('active'); } // binnen lichtgeel, rand mandarijn
     }
   });
 });
});

/* ==== Logout ==== */
function logout(){auth.signOut();}

/* ==== Security: password change ==== */
async function changePassword(){
  const user=auth.currentUser; if(!user) return alert('Please sign in.');
  const current=document.getElementById('cur_pass').value.trim();
  const np=document.getElementById('new_pass').value.trim();
  const nr=document.getElementById('new_pass_repeat').value.trim();
  if(!current || !np || !nr) return alert('Fill in all fields.');
  if(np!==nr) return alert('New passwords do not match.');
  try{
    const cred=firebase.auth.EmailAuthProvider.credential(user.email,current);
    await user.reauthenticateWithCredential(cred);
    await user.updatePassword(np);
    alert('Password updated.');
    document.getElementById('cur_pass').value='';
    document.getElementById('new_pass').value='';
    document.getElementById('new_pass_repeat').value='';
  }catch(e){
    console.error(e); alert(e.message||'Could not update password.');
  }
}

/* ==== Profiel/Adres laden & opslaan ==== */
const inputs={
  name:document.getElementById('ship_name'),
  line1:document.getElementById('ship_line1'),
  city:document.getElementById('ship_city'),
  postal:document.getElementById('ship_postal'),
  country:document.getElementById('ship_country'),
};
const btnEdit=document.getElementById('btn-edit');
const btnSave=document.getElementById('btn-save');

btnEdit.addEventListener('click', ()=>toggleEditable(true));
btnSave.addEventListener('click', saveAddress);

function toggleEditable(on){
  Object.values(inputs).forEach(el=>el.disabled=!on);
  btnSave.disabled=!on;
  btnEdit.disabled=on;
}

async function loadProfile(uid){
  try{
    const snap=await db.collection('users').doc(uid).get();
    if(snap.exists){
      const d=snap.data()||{};
      inputs.name.value=d.name||'';
      inputs.line1.value=d.address_line1||'';
      inputs.city.value=d.city||'';
      inputs.postal.value=d.postal||'';
      inputs.country.value=d.country||'';
      if(d.avatarUrl){ setAvatarImage(d.avatarUrl); }
    }
  }catch(e){ console.error(e); }
  toggleEditable(false);
}

async function saveAddress(){
  const user=auth.currentUser; if(!user) return alert('Please sign in.');
  const payload={
    name: inputs.name.value.trim(),
    address_line1: inputs.line1.value.trim(),
    city: inputs.city.value.trim(),
    postal: inputs.postal.value.trim(),
    country: inputs.country.value.trim(),
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  };
  try{
    await db.collection('users').doc(user.uid).set(payload,{merge:true});
    alert('Details saved.');
    toggleEditable(false);
  }catch(e){
    console.error(e); alert('Could not save your details.');
  }
}

/* ==== Avatar upload + crop ==== */
const avatar=document.getElementById('avatar');
const avatarImg=document.getElementById('avatar-img');
const plusBtn=document.getElementById('avatar-plus');

const modal=document.getElementById('avatar-modal');
const fileInput=document.getElementById('file-input');
const cropCanvas=document.getElementById('crop-canvas');
const ctx=cropCanvas.getContext('2d');
const zoomInput=document.getElementById('zoom');
const btnChoose=document.getElementById('btn-choose');
const btnReset=document.getElementById('btn-reset');
const btnSaveCrop=document.getElementById('btn-save-crop');
const btnClose=document.getElementById('crop-close');

let img=new Image();
let imgLoaded=false;
let state={scale:1, x:0, y:0, dragging:false, startX:0, startY:0};

function setAvatarImage(url){
  avatar.classList.add('has-photo');
  avatarImg.src=url;
  avatarImg.alt='Profile photo';
}

function openModal(){ modal.classList.add('open'); resizeCanvas(); window.addEventListener('resize', resizeCanvas); }
function closeModal(){ modal.classList.remove('open'); window.removeEventListener('resize', resizeCanvas); }
plusBtn.addEventListener('click', openModal);
btnClose.addEventListener('click', closeModal);
modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });

btnChoose.addEventListener('click', ()=>fileInput.click());
btnReset.addEventListener('click', ()=>{
  zoomInput.value=1; state.scale=1; state.x=0; state.y=0; draw();
});

fileInput.addEventListener('change', e=>{
  const file=e.target.files?.[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=ev=>{
    imgLoaded=false;
    img = new Image();
    img.onload=()=>{
      imgLoaded=true;
      // initial fit: cover square
      const W=cropCanvas.width, H=cropCanvas.height;
      const scale=Math.max(W/img.width, H/img.height);
      state.scale=scale; zoomInput.value=Math.max(1, scale).toFixed(2);
      state.x=(W - img.width*scale)/2;
      state.y=(H - img.height*scale)/2;
      draw();
    };
    img.src=ev.target.result;
  };
  reader.readAsDataURL(file);
});

/* Canvas interactie */
function resizeCanvas(){
  const area=document.querySelector('.crop-area');
  const size=Math.min(area.clientWidth, area.clientHeight);
  cropCanvas.width=size; cropCanvas.height=size;
  draw();
}
function draw(){
  const W=cropCanvas.width, H=cropCanvas.height;
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle='#f3efe3'; ctx.fillRect(0,0,W,H);
  if(imgLoaded){
    ctx.save(); ctx.imageSmoothingQuality='high';
    ctx.drawImage(img, state.x, state.y, img.width*state.scale, img.height*state.scale);
    ctx.restore();
  }else{
    // placeholder kruisje
    ctx.strokeStyle='#e2cf97'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(W/2-20,H/2); ctx.lineTo(W/2+20,H/2);
    ctx.moveTo(W/2,H/2-20); ctx.lineTo(W/2,H/2+20); ctx.stroke();
  }
}
cropCanvas.addEventListener('mousedown', e=>{
  if(!imgLoaded) return; state.dragging=true; cropCanvas.classList.add('dragging');
  state.startX=e.offsetX - state.x; state.startY=e.offsetY - state.y;
});
window.addEventListener('mouseup', ()=>{ state.dragging=false; cropCanvas.classList.remove('dragging'); });
cropCanvas.addEventListener('mousemove', e=>{
  if(!state.dragging) return;
  state.x=e.offsetX - state.startX; state.y=e.offsetY - state.startY; draw();
});
zoomInput.addEventListener('input', e=>{
  if(!imgLoaded) return;
  const W=cropCanvas.width, H=cropCanvas.height;
  const prev=state.scale, next=parseFloat(e.target.value);
  const cx=W/2, cy=H/2;
  state.x = cx - ((cx - state.x) * (next/prev));
  state.y = cy - ((cy - state.y) * (next/prev));
  state.scale=next; draw();
});

/* Opslaan naar Storage + Firestore */
btnSaveCrop.addEventListener('click', async ()=>{
  const user=auth.currentUser; if(!user){ alert('Please sign in.'); return; }
  cropCanvas.toBlob(async (blob)=>{
    if(!blob){ alert('Nothing to save.'); return; }
    try{
      const ref=storage.ref().child(`users/${user.uid}/avatar.jpg`);
      await ref.put(blob, {contentType:'image/jpeg'});
      const url=await ref.getDownloadURL();
      await db.collection('users').doc(user.uid).set({avatarUrl:url, updatedAt: firebase.firestore.FieldValue.serverTimestamp()},{merge:true});
      setAvatarImage(url);
      closeModal();
      alert('Profile photo updated.');
    }catch(e){ console.error(e); alert('Could not save your photo.'); }
  }, 'image/jpeg', 0.92);
});

/* Returns demo */
function submitReturn(){
  const id=document.getElementById('ret_order').value.trim();
  const reason=document.getElementById('ret_reason').value.trim();
  if(!id || !reason) return alert('Fill in order and reason.');
  alert('Return submitted. We will contact you soon.');
}

/* Utils */
function escapeHtml(str){ return String(str??'').replace(/[&<>"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[s])); }
</script>

<!--
Apache serverconfiguratie voor caching en headers

<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType application/javascript "access plus 1 year"
</IfModule>

<IfModule mod_headers.c>
  Header set X-Content-Type-Options nosniff
  Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>
-->
</body>
</html>
