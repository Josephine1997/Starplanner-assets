<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Account – Starplanner</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body { font-family:'Montserrat Alternates',sans-serif;margin:0;background:#fff;color:#333; }

    /* ===== Header & Nav ===== */
    nav{
      background-image:url('ArtworkWaterverfkwastachterkopjes.jpg');
      background-repeat:no-repeat;background-position:center;background-size:120% 110%;
      padding:40px 60px;display:flex;justify-content:space-between;align-items:center;
    }
    nav ul{list-style:none;margin:0;padding:0;display:flex;gap:70px;padding-left:100px;}
    nav ul li a{text-decoration:none;color:white;font-size:18px;font-weight:600;text-shadow:1px 1px 3px rgba(0,0,0,0.3);}
    nav ul li a:hover{color:#FF7929;}
    .nav-icons{display:flex;gap:30px;align-items:center;position:relative;}
    .nav-icons img{width:36px;height:36px;cursor:pointer;}
    .cart-link{position:relative;}
    .cart-badge{position:absolute;top:-6px;right:-6px;background:#FF6F61;color:#fff;font-size:12px;font-weight:600;padding:2px 6px;border-radius:50%;min-width:18px;text-align:center;}

    /* ===== Main ===== */
    main{max-width:720px;margin:80px auto;padding:20px;}
    h1{color:#FF8C2B;font-size:38px;margin:0 0 24px;text-align:center;}

    .form-box{
      background:#FFF6E5;border-radius:16px;padding:32px 24px;box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    .form-row{display:grid;grid-template-columns:1fr;gap:18px;}
    .form-field{display:flex;flex-direction:column;}
    .form-field label{font-weight:600;margin-bottom:6px;color:#FF8C2B;}
    .form-field input{
      width:100%;padding:12px 14px;border-radius:10px;border:2px solid #FFC90E;font-size:15px;outline:none;
      transition:border-color .2s, box-shadow .2s;
      background:#fff;
    }
    .form-field input:focus{border-color:#ffb600; box-shadow:0 0 0 3px rgba(255,201,14,.20);}

    .submit-btn{
      display:inline-block;width:100%;background:#FFC90E;color:#fff;font-weight:700;font-size:16px;border:none;
      border-radius:10px;padding:14px 0;cursor:pointer;transition:background .3s; margin-top:8px;
    }
    .submit-btn:hover{background:#e6b800;}

    .toggle-text{margin-top:16px;font-size:14px;color:#555;text-align:center;}
    .toggle-text a{color:#FF8C2B;font-weight:600;text-decoration:none;cursor:pointer;}
    .toggle-text a:hover{text-decoration:underline;}

    /* ===== Account (ingelogd) ===== */
    .account-info{
      background:#FFF6E5;padding:32px 24px;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    .welcome{
      display:flex;align-items:center;gap:16px;margin-bottom:10px;
    }
    .avatar{
      width:64px;height:64px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;
      background: radial-gradient(120px 120px at 30% 30%, #FFF3B5, #FFE37A 60%, #FFC90E 100%);
      border:3px solid #FFB545; box-shadow:0 4px 12px rgba(255,145,0,.25);
    }
    .welcome h2{margin:0;color:#FF8C2B;font-size:22px;}
    .muted{color:#6b6b6b;font-size:14px;margin:2px 0 0;}

    .logout-btn{
      background:#FF6F61;color:#fff;border:none;border-radius:10px;padding:10px 16px;margin-top:18px;
      font-weight:700;cursor:pointer;transition:background .2s;
    }
    .logout-btn:hover{background:#e85b50;}

    .orders{margin-top:26px;}
    .orders h3{color:#FF8C2B;margin:0 0 8px;}
    .order{background:#fff;border:2px solid #FFC90E;border-radius:10px;padding:12px;margin-bottom:12px;}
    .order h4{margin:0 0 8px;color:#FF8C2B;}
    .order ul{margin:0;padding-left:18px;font-size:14px;}
    .order ul li{margin-bottom:4px;}

    /* ===== Footer ===== */
    footer{position:relative;margin-top:60px;overflow:hidden;}
    .footer-decoration{width:100%;height:100px;object-fit:cover;display:block;}
    .footer-text{position:absolute;bottom:10px;width:100%;text-align:center;color:#fff;font-size:14px;text-shadow:1px 1px 3px rgba(0,0,0,0.5);}

    /* ===== Banner (meldingen) ===== */
    .banner{position:fixed;top:16px;left:50%;transform:translateX(-50%);
      padding:12px 16px;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.15);z-index:9999;display:none;}
    .banner.success{background:#34c759;color:#fff;}
    .banner.warn{background:#ff9f0a;color:#4a2a00;}
    .banner.error{background:#ff6f61;color:#fff;}

    /* ===== Password checklist ===== */
    .pw-wrap{
      overflow:hidden; transition:max-height .35s ease, opacity .25s ease;
      max-height:0; opacity:0; will-change:max-height, opacity;
      margin-top:6px;
    }
    .pw-checklist{
      border-radius:12px; padding:14px 14px 10px;
      background: linear-gradient(180deg, #FFF9CF 0%, #FFE9A6 100%);
      border:1.5px solid #FFCE58;
      box-shadow: 0 6px 16px rgba(255,161,22,.18) inset;
    }
    .pw-title{font-weight:700; color:#A45C00; margin:0 0 8px; font-size:14px;}
    .rule{display:flex;align-items:center;gap:10px; font-size:14px; color:#7a5200; padding:6px 0;}
    .tick{
      width:18px;height:18px; border-radius:4px; display:inline-flex; align-items:center; justify-content:center;
      background:#fff3c8; border:1.5px solid #ffd166; transition:all .2s ease;
      flex:0 0 18px;
    }
    .rule.ok .tick{ background:#E8F8E8; border-color:#2ecc71; box-shadow:0 0 0 2px rgba(46,204,113,.15); }
    .tick svg{ width:12px; height:12px; opacity:.35; transition:opacity .2s ease; }
    .rule.ok .tick svg{ opacity:1; }
  </style>
</head>
<body>
  <!-- ===== Header ===== -->
  <header>
    <nav>
      <ul>
        <li><a href="index.html">HOME</a></li>
        <li><a href="thestorybehind.html">THE STORY BEHIND</a></li>
        <li><a href="shop.html">SHOP</a></li>
        <li><a href="plannertips.html">PLANNER TIPS</a></li>
        <li><a href="contact.html">CONTACT</a></li>
      </ul>
      <div class="nav-icons">
        <a href="account.html"><img src="user-icon.svg" alt="User"></a>
        <a href="checkout.html" class="cart-link">
          <img src="shoppingbag.svg" alt="Shopping Bag">
          <span class="cart-badge" id="cart-count">0</span>
        </a>
      </div>
    </nav>
  </header>

  <!-- Meldingen -->
  <div id="banner" class="banner"></div>

  <main>
    <!-- ===== Auth ===== -->
    <section id="auth-section">
      <h1 id="form-title">Create Account</h1>
      <div class="form-box">
        <form id="account-form" novalidate>
          <div class="form-row">
            <div class="form-field">
              <label for="email">Email</label>
              <input type="email" id="email" placeholder="Enter your email" required>
              <div id="emailError" class="error" style="display:none;">Please enter a valid email address.</div>
            </div>

            <div class="form-field">
              <label for="password">Password</label>
              <input type="password" id="password" placeholder="Create a password" required>
              <!-- Password checklist -->
              <div id="pwWrap" class="pw-wrap">
                <div class="pw-checklist" id="pwChecklist">
                  <p class="pw-title">Your password must contain:</p>
                  <div class="rule" data-rule="len">
                    <span class="tick" aria-hidden="true">
                      <svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
                    </span>
                    <span>At least 8 characters</span>
                  </div>
                  <div class="rule" data-rule="lower">
                    <span class="tick"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg></span>
                    <span>Lower case letters (a-z)</span>
                  </div>
                  <div class="rule" data-rule="upper">
                    <span class="tick"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg></span>
                    <span>Upper case letters (A-Z)</span>
                  </div>
                  <div class="rule" data-rule="num">
                    <span class="tick"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg></span>
                    <span>Numbers (0-9)</span>
                  </div>
                  <div class="rule" data-rule="spec">
                    <span class="tick"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg></span>
                    <span>Special characters (e.g. !@#$%^&*)</span>
                  </div>
                  <div class="rule" data-rule="match">
                    <span class="tick"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg></span>
                    <span>Passwords match</span>
                  </div>
                </div>
              </div>
              <div id="passwordError" class="error" style="display:none;">Please meet the password requirements.</div>
            </div>

            <div class="form-field" id="repeat-field">
              <label for="repeat">Repeat Password</label>
              <input type="password" id="repeat" placeholder="Repeat your password">
              <div id="repeatError" class="error" style="display:none;">Passwords don’t match.</div>
            </div>

            <button type="submit" class="submit-btn" id="submit-btn">Register</button>
          </div>
        </form>

        <div class="toggle-text">
          Already have an account? <a id="toggle-link" onclick="toggleForm()">Login</a>
        </div>
      </div>
    </section>

    <!-- ===== Ingelogd ===== -->
    <section id="account-section" style="display:none;">
      <div class="account-info">
        <div class="welcome">
          <div class="avatar" aria-hidden="true">
            <!-- subtiele person SVG in oranje-geel tint -->
            <svg viewBox="0 0 24 24" width="34" height="34" fill="#C97300">
              <path d="M12 12c2.76 0 5-2.24 5-5S14.76 2 12 2 7 4.24 7 7s2.24 5 5 5zm0 2c-4.33 0-8 2.17-8 5v1h16v-1c0-2.83-3.67-5-8-5z"/>
            </svg>
          </div>
          <div>
            <h2>Welcome back!</h2>
            <p class="muted" id="user-email"></p>
          </div>
        </div>

        <p id="verify-note" class="muted" style="display:none;">
          Your email is not verified yet. Please check your inbox.
          <a href="#" id="resend-link" style="color:#FF8C2B; text-decoration:underline;">Resend verification email</a>
        </p>

        <div id="orders" class="orders"></div>

        <button class="logout-btn" onclick="logout()">Sign out</button>
      </div>
    </section>
  </main>

  <!-- ===== Footer ===== -->
  <footer>
    <img src="ArtworkWaterverfkwastfootheader.jpg" alt="Footer Decoration" class="footer-decoration">
    <div class="footer-text">© 2025 Starplanner – All rights reserved.</div>
  </footer>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>

  <script>
    /* ==== Firebase init ==== */
    const firebaseConfig = {
      apiKey:"AIzaSyApt-W5-Ag4Ov2JxVcudSrV4VL0zCBE8pc",
      authDomain:"starplanner-3acf9.firebaseapp.com",
      projectId:"starplanner-3acf9",
      storageBucket:"starplanner-3acf9.firebasestorage.app",
      messagingSenderId:"793684440573",
      appId:"1:793684440573:web:5beb2ab6f64b4fc110d594"
    };
    firebase.initializeApp(firebaseConfig);
    const auth=firebase.auth();
    const db=firebase.firestore();

    /* ==== Helpers ==== */
    const banner=document.getElementById('banner');
    function showBanner(type,text,ms=3000){
      banner.className='banner '+type;
      banner.textContent=text;
      banner.style.display='block';
      clearTimeout(showBanner._t);
      showBanner._t=setTimeout(()=>banner.style.display='none',ms);
    }
    function showError(id,show=true){
      const el=document.getElementById(id);
      if(!el)return;
      el.style.display=show?'block':'none';
    }

    /* ==== Password checklist live ==== */
    const pwInput = document.getElementById('password');
    const rptInput = document.getElementById('repeat');
    const pwWrap  = document.getElementById('pwWrap');
    const rulesEl = document.getElementById('pwChecklist');
    let hideTimer = null;

    const rules = {
      len:   v => v.length >= 8,
      lower: v => /[a-z]/.test(v),
      upper: v => /[A-Z]/.test(v),
      num:   v => /[0-9]/.test(v),
      spec:  v => /[!@#$%^&*]/.test(v),
      match: (v, r) => v.length>0 && v === r
    };

    function setChecklistVisible(visible) {
      if (visible) {
        pwWrap.style.maxHeight = rulesEl.scrollHeight + 24 + 'px';
        pwWrap.style.opacity = '1';
      } else {
        pwWrap.style.maxHeight = '0';
        pwWrap.style.opacity = '0';
      }
    }

    function updateChecklist() {
      const v = pwInput.value || '';
      const r = rptInput.value || '';
      const results = {
        len: rules.len(v),
        lower: rules.lower(v),
        upper: rules.upper(v),
        num: rules.num(v),
        spec: rules.spec(v),
        match: rules.match(v, r)
      };

      // mark each rule
      Object.keys(results).forEach(key=>{
        const row = rulesEl.querySelector(`.rule[data-rule="${key}"]`);
        if (!row) return;
        row.classList.toggle('ok', !!results[key]);
      });

      const allOk = Object.values(results).every(Boolean);

      clearTimeout(hideTimer);
      if (allOk) {
        // 3s visible after last rule turns ok
        setChecklistVisible(true);
        hideTimer = setTimeout(()=> setChecklistVisible(false), 3000);
      } else {
        setChecklistVisible(true);
      }
    }

    pwInput.addEventListener('input', updateChecklist);
    rptInput.addEventListener('input', updateChecklist);
    pwInput.addEventListener('focus', ()=> setChecklistVisible(true));
    rptInput.addEventListener('focus', ()=> setChecklistVisible(true));
    pwInput.addEventListener('blur', ()=> {/* keep visible while typing / next field */});
    rptInput.addEventListener('blur', ()=> {/* same */});

    /* ==== Toggle Login / Register ==== */
    let isRegister=true;
    function toggleForm(){
      isRegister=!isRegister;
      document.getElementById('form-title').textContent=isRegister?'Create Account':'Login';
      document.getElementById('submit-btn').textContent=isRegister?'Register':'Login';
      document.getElementById('repeat-field').style.display=isRegister?'block':'none';
      ['emailError','passwordError','repeatError'].forEach(id=>showError(id,false));
      // On switch, show checklist only if registering
      if (isRegister) {
        setChecklistVisible(true);
      } else {
        setChecklistVisible(false);
      }
    }

    /* ==== Submit ==== */
    document.getElementById('account-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email   = document.getElementById('email').value.trim();
      const pass    = pwInput.value;
      const repeat  = rptInput.value;

      // basic email check
      let hasErr=false;
      showError('emailError', false);
      showError('passwordError', false);
      showError('repeatError', false);

      if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        showError('emailError', true); hasErr=true;
      }

      // enforce our 6 requirements when registering
      if (isRegister) {
        const okAll = rules.len(pass) && rules.lower(pass) && rules.upper(pass) &&
                      rules.num(pass) && rules.spec(pass) && rules.match(pass, repeat);
        if (!okAll) { showError('passwordError', true); hasErr=true; }
      } else {
        // login: just require something in password
        if (!pass) { showError('passwordError', true); hasErr=true; }
      }

      if (isRegister && pass !== repeat) {
        showError('repeatError', true); hasErr=true;
      }
      if (hasErr) return;

      try{
        if(isRegister){
          const cred = await auth.createUserWithEmailAndPassword(email, pass);
          await db.collection('users').doc(cred.user.uid).set({
            email,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          }, { merge:true });
          await cred.user.sendEmailVerification();
          showBanner('success','✅ Confirmation email sent! Please verify your inbox.');
        }else{
          await auth.signInWithEmailAndPassword(email, pass);
          showBanner('success','✅ Login successful!');
        }
      }catch(err){
        showBanner('error', err.message || 'Something went wrong.');
      }
    });

    /* ==== Auth state ==== */
    auth.onAuthStateChanged(async user=>{
      if(user){
        document.getElementById('auth-section').style.display='none';
        document.getElementById('account-section').style.display='block';
        document.getElementById('user-email').textContent=`Logged in as: ${user.email}`;
        document.getElementById('verify-note').style.display=user.emailVerified?'none':'block';
        loadOrders(user.uid);
      }else{
        document.getElementById('auth-section').style.display='block';
        document.getElementById('account-section').style.display='none';
      }
    });

    /* ==== Resend verification ==== */
    document.getElementById('resend-link').addEventListener('click', async e=>{
      e.preventDefault();
      const u = auth.currentUser;
      if(!u) return;
      try{
        await u.sendEmailVerification();
        showBanner('success','Verification email resent. Please check your inbox.');
      }catch(err){
        showBanner('error','Could not resend verification.');
      }
    });

    /* ==== Orders ==== */
    async function loadOrders(userId){
      const ordersDiv=document.getElementById('orders');
      ordersDiv.innerHTML = "<h3>My Orders</h3>";
      try{
        const snap=await db.collection('orders')
          .where('userId','==',userId)
          .orderBy('date','desc')
          .get();
        if(snap.empty){
          ordersDiv.innerHTML += "<p class='muted'>No orders yet.</p>";
          return;
        }
        snap.forEach(doc=>{
          const o=doc.data();
          const when=o.date?.toDate?o.date.toDate().toLocaleString():'Unknown date';
          const itemsHtml=Array.isArray(o.items)
            ? o.items.map(i=>`<li>${i.name} – €${Number(i.price).toFixed(2)} × ${i.qty}</li>`).join('')
            : '';
          const block = document.createElement('div');
          block.className='order';
          block.innerHTML = `
            <h4>Order on ${when}</h4>
            <ul>${itemsHtml}</ul>
            <p><strong>Total:</strong> €${Number(o.total||0).toFixed(2)}</p>`;
          ordersDiv.appendChild(block);
        });
      }catch(err){
        ordersDiv.innerHTML += "<p>Could not load orders.</p>";
      }
    }

    /* ==== Sign out ==== */
    function logout(){
      auth.signOut().then(()=> showBanner('success','You have been logged out successfully.'));
    }

    /* Cart badge init */
    const cartCount=document.getElementById('cart-count');
    const cart=JSON.parse(localStorage.getItem('cart'))||[];
    cartCount.textContent=cart.length;
  </script>
</body>
</html>
