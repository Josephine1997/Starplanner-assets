<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Checkout ‚Äì Starplanner</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@400;600&display=swap" rel="stylesheet">

<style>
body{font-family:'Montserrat Alternates',sans-serif;margin:0;padding:0;background:#fff;}
nav{background-image:url('ArtworkWaterverfkwastachterkopjes.jpg');background-repeat:no-repeat;background-position:center;background-size:120% 110%;padding:40px 60px;display:flex;justify-content:space-between;align-items:center;}
nav ul{list-style:none;margin:0;padding:0;display:flex;gap:70px;padding-left:100px;}
nav ul li a{text-decoration:none;color:white;font-size:18px;font-weight:600;text-shadow:1px 1px 3px rgba(0,0,0,0.3);}
nav ul li a:hover{color:#FF7929;}
.nav-icons{display:flex;gap:30px;align-items:center;position:relative;}
.nav-icons img{width:36px;height:36px;cursor:pointer;}
.cart-link{position:relative;}
.cart-badge{position:absolute;top:-6px;right:-6px;background:#FF6F61;color:#fff;font-size:12px;font-weight:600;padding:2px 6px;border-radius:50%;min-width:18px;text-align:center;}
main{padding:20px;max-width:900px;margin:0 auto;}
h1{color:#FFC90E;text-align:center;margin-top:30px;margin-bottom:10px;}
.continue{color:#FFC90E;text-decoration:underline;text-align:center;cursor:pointer;}
.cart-header{display:flex;justify-content:space-between;margin:40px 0 20px;color:#FFC90E;font-weight:600;font-size:16px;}
.cart-item{display:flex;justify-content:space-between;align-items:center;padding:15px 0;border-bottom:1px solid #ddd;}
.cart-item img{width:80px;height:auto;margin-right:20px;}
.product-info{flex:1;}
.remove{color:#FFC90E;text-decoration:underline;cursor:pointer;font-size:14px;margin-top:4px;}
.qty-controls{display:flex;align-items:center;gap:5px;margin-top:5px;}
.qty-btn{background:#FFC90E;border:none;color:#fff;font-size:16px;width:28px;height:28px;border-radius:4px;cursor:pointer;font-weight:bold;}
.qty-box{min-width:40px;text-align:center;border:2px solid #FFC90E;padding:4px;border-radius:4px;font-weight:600;background:#fff;}
.empty-cart{text-align:center;font-size:18px;color:#666;margin:40px 0;}
.summary{margin-top:40px;font-size:18px;font-weight:600;color:#333;}
.tax-note{font-size:14px;color:#FFC90E;font-weight:400;margin-top:4px;}
.checkout-btn{display:inline-block;margin-top:20px;padding:16px 36px;background:#FFC90E;color:#fff;font-size:18px;font-weight:600;border:none;border-radius:6px;cursor:pointer;}
.checkout-btn:hover{background:#e6b800;}
footer{position:relative;margin-top:60px;overflow:hidden;}
.footer-decoration{width:100%;height:100px;object-fit:cover;display:block;}
.footer-text{position:absolute;bottom:10px;width:100%;text-align:center;color:#fff;font-size:14px;text-shadow:1px 1px 3px rgba(0,0,0,0.5);}

/* üåü Stardust overlay */
#stardust-overlay{display:flex;justify-content:center;align-items:center;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);color:white;font-size:22px;font-weight:600;z-index:9999;flex-direction:column;overflow:hidden;text-align:center;}
#stardust{position:absolute;width:100%;height:100%;top:0;left:0;overflow:hidden;}
.star{
  position:absolute;border-radius:50%;
  background:radial-gradient(circle,rgba(255,255,255,1) 0%,#fff4b0 40%,#ffc0cb 90%);
  box-shadow:0 0 8px 2px rgba(255,255,255,0.8);
  opacity:0;animation:twinkle 2s infinite ease-in-out;transform-origin:center;
  transition:opacity .5s;
}
@keyframes twinkle{0%,100%{opacity:0;transform:scale(1);}50%{opacity:1;transform:scale(1.6);}}
</style>
</head>

<body>
<div id="stardust-overlay">
  <div id="stardust"></div>
  <div id="overlay-text"></div>
</div>

<header>
<nav>
<ul>
<li><a href="index.html">HOME</a></li>
<li><a href="thestorybehind.html">THE STORY BEHIND</a></li>
<li><a href="shop.html">SHOP</a></li>
<li><a href="plannertips.html">PLANNER TIPS</a></li>
<li><a href="contact.html">CONTACT</a></li>
</ul>
<div class="nav-icons">
<a href="account.html"><img src="user-icon.svg" alt="User"></a>
<a href="checkout.html" class="cart-link">
<img src="shoppingbag.svg" alt="Shopping Bag">
<span id="cart-count" class="cart-badge">0</span>
</a>
</div>
</nav>
</header>

<main>
<h1>Your cart</h1>
<div class="continue" onclick="window.location.href='shop.html'">Continue shopping</div>
<div class="cart-header"><div>PRODUCT</div><div>PRICE</div></div>
<div id="cart-items" class="cart-items"></div>
<div class="summary">
Subtotal: ‚Ç¨<span id="subtotal">0.00</span>
<div class="tax-note">Taxes and shipping calculated at checkout</div>
<button class="checkout-btn" onclick="placeOrder()">Checkout</button>
</div>
</main>

<footer>
<img src="ArtworkWaterverfkwastfootheader.jpg" alt="Footer Decoration" class="footer-decoration">
<div class="footer-text">¬© 2025 Starplanner ‚Äì All rights reserved.</div>
</footer>

<audio id="sound-whoosh" src="whoosh-soft.mp3" preload="auto" playsinline></audio>
<audio id="sound-chime"  src="sparkle-chime.mp3" preload="auto" playsinline></audio>

<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>

<script>
/* --- Firebase & cart --- */
const firebaseConfig={apiKey:"AIzaSyApt-W5-Ag4Ov2JxVcudSrV4VL0zCBE8pc",authDomain:"starplanner-3acf9.firebaseapp.com",projectId:"starplanner-3acf9",storageBucket:"starplanner-3acf9.firebasestorage.app",messagingSenderId:"793684440573",appId:"1:793684440573:web:5beb2ab6f64b4fc110d594"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();const db=firebase.firestore();

const cartContainer=document.getElementById('cart-items');
const subtotalEl=document.getElementById('subtotal');
const cartCount=document.getElementById('cart-count');

let cart=(JSON.parse(localStorage.getItem('cart'))||[]).map(it=>({...it,qty:Number(it?.qty)>0?Number(it.qty):1,price:Number(it?.price)?Number(it.price):0}));
localStorage.setItem('cart',JSON.stringify(cart));
cartCount.textContent=cart.reduce((s,it)=>s+(Number(it.qty)||1),0);

function renderCart(){
  cartContainer.innerHTML='';let total=0;
  if(cart.length===0){cartContainer.innerHTML=`<div class="empty-cart">Your cart is empty</div>`;}
  else{
    cart.forEach((item,index)=>{
      const price=Number(item.price)||0;const qty=Number(item.qty)||1;
      const div=document.createElement('div');
      div.classList.add('cart-item');
      div.innerHTML=`<div style="display:flex;align-items:center;">
        <img src="shoppingbag.svg" alt="${item.name}">
        <div class="product-info">
          <div>${item.name}</div>
          <div class="remove" onclick="removeItem(${index})">REMOVE</div>
        </div></div>
        <div>‚Ç¨${price.toFixed(2)}<br>
          <div class="qty-controls">
            <button class="qty-btn" onclick="updateQty(${index},-1)">‚Äì</button>
            <span class="qty-box">${qty}</span>
            <button class="qty-btn" onclick="updateQty(${index},1)">+</button>
          </div>
        </div>`;
      cartContainer.appendChild(div);
      total+=price*qty;
    });
  }
  subtotalEl.textContent=total.toFixed(2);
}
renderCart();

function removeItem(i){cart.splice(i,1);localStorage.setItem('cart',JSON.stringify(cart));cartCount.textContent=cart.reduce((s,it)=>s+(Number(it.qty)||1),0);renderCart();}
function updateQty(i,d){const c=Number(cart[i]?.qty)||1;if(c===1&&d<0){removeItem(i);return;}cart[i].qty=c+d<1?1:c+d;localStorage.setItem('cart',JSON.stringify(cart));cartCount.textContent=cart.reduce((s,it)=>s+(Number(it.qty)||1),0);renderCart();}
async function placeOrder(){const u=auth.currentUser;if(!u){alert("You must be logged in to complete your order.");return;}if(cart.length===0){alert("Your cart is empty.");return;}const t=cart.reduce((s,it)=>s+((Number(it.price)||0)*(Number(it.qty)||1)),0);try{await db.collection('orders').add({userId:u.uid,email:u.email,items:cart,total:t,date:firebase.firestore.FieldValue.serverTimestamp()});alert("‚úÖ Your order has been placed successfully!");localStorage.removeItem('cart');window.location.href="account.html";}catch(e){alert("‚ùå Error placing order: "+e.message);}}

/* --- Audio --- */
const whoosh=document.getElementById('sound-whoosh');
const chime=document.getElementById('sound-chime');
let soundReady=false;const queue=[];
function unlockAudio(){if(soundReady)return;soundReady=true;[whoosh,chime].forEach(a=>{try{a.play().then(()=>a.pause()).catch(()=>{});}catch(_){}});flushQueue();}
function playSound(el,vol=0.8){const fn=()=>{try{el.currentTime=0;el.volume=vol;el.play().catch(()=>{});}catch(_){}};if(soundReady)fn();else queue.push(fn);}
function stopSound(el){try{el.pause();el.currentTime=0;}catch(_){}} 
function flushQueue(){while(queue.length){try{queue.shift()();}catch(_){}}}
["click","touchstart","keydown","pointerdown"].forEach(ev=>{window.addEventListener(ev,unlockAudio,{once:true,passive:true});});

/* --- Stardust: start pas na eerste scroll --- */
window.addEventListener('load',()=>{
  const overlay=document.getElementById('stardust-overlay');
  const textEl=document.getElementById('overlay-text');
  const container=document.getElementById('stardust');

  const justAdded=localStorage.getItem('justAdded')==='true';
  localStorage.removeItem('justAdded');
  if(!justAdded){fadeOut(2500);return;}

  function startStardust(){
    unlockAudio();
    textEl.textContent="Sprinkling a little stardust‚Ä¶";

    // ‚≠ê Sterren aanmaken pas nu
    const stars=[];
    for(let i=0;i<30;i++){
      const s=document.createElement('span');
      s.classList.add('star');
      const size=Math.random()*2+1;
      s.style.width=s.style.height=`${size}px`;
      s.style.top =`${Math.random()*window.innerHeight}px`;
      s.style.left=`${Math.random()*window.innerWidth}px`;
      s.style.animationDelay=`${Math.random()*2}s`;
      container.appendChild(s);
      stars.push(s);
    }

    // üéØ Doel bepalen: bag naast het laatst toegevoegde product
    const last=localStorage.getItem('lastAddedItemName');
    let targetBag=null;
    if(last){
      document.querySelectorAll('.cart-item').forEach(it=>{
        if(it.textContent.includes(last)){
          const img=it.querySelector('img');
          if(img) targetBag=img;
        }
      });
    }
    if(!targetBag){
      targetBag=document.querySelector('.nav-icons img[alt="Shopping Bag"]');
    }
    const r=targetBag.getBoundingClientRect();
    const cx=r.left + r.width/2;
    const cy=r.top  + r.height/2;

    // ‚è±Ô∏è 1s later start samenkomen ‚Üí chime NU
    setTimeout(()=>{
      playSound(chime,0.9); // start bij begin samenkomen
      stars.forEach((s,i)=>{
        const a=i*0.35; // spiraalgevoel
        s.style.transition='top 2s cubic-bezier(0.55,0.05,0.19,1),left 2s cubic-bezier(0.55,0.05,0.19,1),transform 2s ease-in-out,opacity 2s ease';
        s.style.top =`${cy + Math.sin(a)*8}px`;
        s.style.left=`${cx + Math.cos(a)*8}px`;
        s.style.transform=`scale(0.3) rotate(${a*8}rad)`;
        s.style.opacity='0.9';
      });
    },1000);

    // ‚è±Ô∏è exact 3.0s totaal ‚Üí whoosh + explosie (1s + 2s)
    setTimeout(()=>{
      playSound(whoosh,0.9);

      // Explosie flair
      const flare=document.createElement('div');
      flare.style.position='fixed';
      flare.style.left=`${cx-50}px`;flare.style.top=`${cy-50}px`;
      flare.style.width='100px';flare.style.height='100px';
      flare.style.borderRadius='50%';
      flare.style.background='radial-gradient(circle,rgba(255,255,200,0.9)0%,rgba(255,180,120,0.3)50%,transparent 80%)';
      flare.style.pointerEvents='none';flare.style.opacity='0';
      flare.style.transition='opacity .6s ease-out,transform .6s ease-out';
      flare.style.zIndex='10000';
      document.body.appendChild(flare);
      requestAnimationFrame(()=>{flare.style.opacity='1';flare.style.transform='scale(1.6)';});
      setTimeout(()=>flare.remove(),700);

      // Mini-sterren burst
      for(let j=0;j<12;j++){
        const sp=document.createElement('span');
        sp.classList.add('star');
        sp.style.width='3px';sp.style.height='3px';
        sp.style.top =`${cy}px`;sp.style.left=`${cx}px`;sp.style.opacity='1';
        sp.style.transition='top .8s ease-out,left .8s ease-out,opacity .8s ease-out,transform .8s ease-out';
        container.appendChild(sp);
        const ang=Math.random()*Math.PI*2;
        const dist=60+Math.random()*90;
        requestAnimationFrame(()=>{
          sp.style.top =`${cy+Math.sin(ang)*dist}px`;
          sp.style.left=`${cx+Math.cos(ang)*dist}px`;
          sp.style.opacity='0';
          sp.style.transform='scale(0.6)';
        });
      }

      // Geluiden netjes stoppen
      setTimeout(()=>{
        stopSound(chime);
        stopSound(whoosh);
      },1200);

      fadeOut(4000);
    },3000);
  }

  function firstScroll(){
    window.removeEventListener('scroll',firstScroll);
    startStardust();
  }
  window.addEventListener('scroll',firstScroll,{once:true,passive:true});
});

function fadeOut(ms){
  const overlay=document.getElementById('stardust-overlay');
  setTimeout(()=>{
    overlay.style.transition='opacity 1s ease';
    overlay.style.opacity='0';
    setTimeout(()=>overlay.style.display='none',1000);
  },ms);
  setTimeout(()=>overlay.style.display='none',7000);
}
</script>
</body>
</html>
