<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Checkout – Starplanner</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@400;600&family=Poppins:ital,wght@1,500&display=swap" rel="stylesheet">

  <style>
    body { font-family:'Montserrat Alternates',sans-serif; margin:0; padding:0; background:#fff; }

    /* Header */
    nav {
      background-image:url('ArtworkWaterverfkwastachterkopjes.jpg');
      background-repeat:no-repeat;
      background-position:center;
      background-size:120% 110%;
      padding:40px 60px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    nav ul {
      list-style:none; margin:0; padding:0;
      display:flex; gap:70px; padding-left:100px;
    }
    nav ul li a {
      text-decoration:none; color:white; font-size:18px;
      font-weight:600; text-shadow:1px 1px 3px rgba(0,0,0,0.3);
    }
    nav ul li a:hover { color:#FF7929; }
    .nav-icons { display:flex; gap:30px; align-items:center; position:relative; }
    .nav-icons img { width:36px; height:36px; cursor:pointer; }
    .cart-badge {
      position:absolute; top:-6px; right:-6px;
      background:#FF6F61; color:#fff; font-size:12px; font-weight:600;
      padding:2px 6px; border-radius:50%; min-width:18px; text-align:center;
    }

    /* Main */
    main { padding:20px; max-width:900px; margin:0 auto; }
    h1 { color:#FFC90E; text-align:center; margin-top:30px; margin-bottom:10px; }
    .continue { color:#FFC90E; text-decoration:underline; text-align:center; cursor:pointer; }
    .cart-header { display:flex; justify-content:space-between; margin:40px 0 20px; color:#FFC90E; font-weight:600; font-size:16px; }

    .cart-item {
      display:flex; justify-content:space-between; align-items:center;
      padding:18px 0; border-bottom:1px solid #ddd; gap:10px;
    }
    .cart-item-left { display:flex; align-items:center; gap:15px; flex:1; }
    .product-thumb { width:80px; height:auto; border-radius:6px; }
    .product-info { flex:1; }
    .cart-item-right { display:flex; align-items:center; gap:20px; justify-content:flex-end; min-width:160px; }
    .price { font-weight:600; color:#333; font-size:16px; }

    .qty-controls {
      display:flex; align-items:center; justify-content:center; gap:5px;
      border:1.5px solid #FFC90E; border-radius:8px; padding:3px 6px;
    }
    .qty-btn {
      background:#FFC90E; border:none; color:#fff; font-size:18px;
      width:28px; height:28px; border-radius:6px; cursor:pointer; font-weight:bold;
      display:flex; align-items:center; justify-content:center; transition:background .2s;
    }
    .qty-btn:hover { background:#e6b800; }
    .qty-box { min-width:34px; text-align:center; font-weight:600; font-size:15px; color:#333; }

    .remove-btn {
      background:none; border:none; color:#FF6F61;
      font-weight:700; cursor:pointer; font-size:16px; transition:color .2s;
    }
    .remove-btn:hover { color:#ff3d2e; }

    .empty-cart { text-align:center; font-size:18px; color:#666; margin:40px 0; }
    .summary { margin-top:40px; font-size:18px; font-weight:600; color:#333; }
    .tax-note { font-size:14px; color:#FFC90E; font-weight:400; margin-top:4px; }
    .checkout-btn {
      display:inline-block; margin-top:20px; padding:16px 36px;
      background:#FFC90E; color:#fff; font-size:18px; font-weight:600;
      border:none; border-radius:6px; cursor:pointer; transition:background .2s;
    }
    .checkout-btn:hover { background:#e6b800; }

    footer { position:relative; margin-top:60px; overflow:hidden; }
    .footer-decoration { width:100%; height:100px; object-fit:cover; display:block; }
    .footer-text {
      position:absolute; bottom:10px; width:100%; text-align:center;
      color:#fff; font-size:14px; text-shadow:1px 1px 3px rgba(0,0,0,0.5);
    }

    /* 🌟 Loading overlay styles */
    #loading-overlay {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(255,255,255,0.8);
      backdrop-filter:blur(2px);
      display:none; /* standaard verborgen */
      flex-direction:column; justify-content:center; align-items:center;
      z-index:9999;
    }
    .loading-text {
      font-family:'Poppins',sans-serif; font-style:italic; font-weight:500; font-size:26px;
      background:linear-gradient(90deg,#fff7cc,#ffe4b2,#ffd7a3,#ffc38b,#ffb07a);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      text-shadow:0 0 8px rgba(255,207,150,0.3);
      margin-bottom:25px;
    }
    .loading-bar {
      width:60%; height:10px; border-radius:8px;
      background:linear-gradient(135deg,#ffffff 0%,#FFF8D6 20%,#FFE6B3 40%,#FFD18B 60%,#FFB35C 80%,#FFA073 100%);
      background-size:300% 300%; animation:gradientFlow 2.5s ease-in-out infinite;
      box-shadow:0 0 12px rgba(255,180,90,0.25);
      position:relative; overflow:hidden;
    }
    @keyframes gradientFlow {
      0% { background-position:0% 50%; }
      50% { background-position:100% 50%; }
      100% { background-position:0% 50%; }
    }
    .stardust {
      position:absolute; top:0; left:0; width:100%; height:100%;
      pointer-events:none; overflow:hidden;
    }
    .stardust span {
      position:absolute; width:2px; height:2px;
      background:radial-gradient(circle,rgba(255,255,255,0.95)0%,rgba(255,247,200,0.4)60%,transparent 100%);
      border-radius:50%; opacity:0; animation:twinkle 4s ease-in-out infinite;
    }
    @keyframes twinkle {
      0%,100% { opacity:0; transform:scale(0.5); }
      50% { opacity:1; transform:scale(1.3); }
    }
  </style>
</head>

<body>
<header>
  <nav>
    <ul>
      <li><a href="index.html">HOME</a></li>
      <li><a href="thestorybehind.html">THE STORY BEHIND</a></li>
      <li><a href="shop.html">SHOP</a></li>
      <li><a href="plannertips.html">PLANNER TIPS</a></li>
      <li><a href="contact.html">CONTACT</a></li>
    </ul>
    <div class="nav-icons">
      <a href="account.html"><img src="user-icon.svg" alt="User"></a>
      <a href="checkout.html" class="cart-link">
        <img src="shoppingbag.svg" alt="Shopping Bag">
        <span id="cart-count" class="cart-badge">0</span>
      </a>
    </div>
  </nav>
</header>

<main>
  <h1>Your cart</h1>
  <div class="continue" onclick="window.location.href='shop.html'">Continue shopping</div>

  <div class="cart-header">
    <div>PRODUCT</div>
    <div>PRICE</div>
  </div>

  <div id="cart-items"></div>

  <div class="summary">
    Subtotal: €<span id="subtotal">0.00</span>
    <div class="tax-note">Taxes and shipping calculated at checkout</div>
    <button class="checkout-btn" onclick="placeOrder()">Checkout</button>
  </div>
</main>

<footer>
  <img src="ArtworkWaterverfkwastfootheader.jpg" alt="Footer Decoration" class="footer-decoration">
  <div class="footer-text">© 2025 Starplanner – All rights reserved.</div>
</footer>

<!-- 🌟 Loading overlay -->
<div id="loading-overlay">
  <div class="stardust" id="stardust"></div>
  <div class="loading-text">Sprinkling a little stardust…</div>
  <div class="loading-bar"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>

<script>
  // === Firebase setup ===
  const firebaseConfig = {
    apiKey: "AIzaSyApt-W5-Ag4Ov2JxVcudSrV4VL0zCBE8pc",
    authDomain: "starplanner-3acf9.firebaseapp.com",
    projectId: "starplanner-3acf9",
    storageBucket: "starplanner-3acf9.firebasestorage.app",
    messagingSenderId: "793684440573",
    appId: "1:793684440573:web:5beb2ab6f64b4fc110d594"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // === Elements ===
  const cartContainer = document.getElementById('cart-items');
  const subtotalEl = document.getElementById('subtotal');
  const cartCount = document.getElementById('cart-count');
  const overlay = document.getElementById('loading-overlay');

  // === Cart logic ===
  let cart = JSON.parse(localStorage.getItem('cart')) || [];
  cart = cart.map(item => ({ ...item, qty: item.qty || 1 }));

  function updateCartCount() {
    cartCount.textContent = cart.reduce((sum, item) => sum + item.qty, 0);
  }

  function renderCart() {
    cartContainer.innerHTML = '';
    let total = 0;

    if (cart.length === 0) {
      cartContainer.innerHTML = `<div class="empty-cart">Your cart is empty</div>`;
      subtotalEl.textContent = '0.00';
      updateCartCount();
      return;
    }

    cart.forEach((item, index) => {
      const div = document.createElement('div');
      div.classList.add('cart-item');
      div.innerHTML = `
        <div class="cart-item-left">
          <img src="shoppingbag.svg" alt="${item.name}" class="product-thumb">
          <div class="product-info">
            <strong>${item.name}</strong><br>
            <small>${item.file}</small>
          </div>
        </div>
        <div class="cart-item-right">
          <div class="price">€${(item.price * item.qty).toFixed(2)}</div>
          <div class="qty-controls">
            <button class="qty-btn" onclick="updateQty(${index}, -1)">–</button>
            <span class="qty-box">${item.qty}</span>
            <button class="qty-btn" onclick="updateQty(${index}, 1)">+</button>
          </div>
          <button class="remove-btn" onclick="removeItem(${index})">✕</button>
        </div>`;
      cartContainer.appendChild(div);
      total += item.price * item.qty;
    });

    subtotalEl.textContent = total.toFixed(2);
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartCount();
  }

  function updateQty(index, delta) {
    cart[index].qty += delta;
    if (cart[index].qty <= 0) removeItem(index);
    renderCart();
  }

  function removeItem(index) {
    cart.splice(index, 1);
    renderCart();
  }

  async function placeOrder() {
    const user = auth.currentUser;
    if (!user) { alert("You must be logged in to complete your order."); return; }
    if (cart.length === 0) { alert("Your cart is empty."); return; }

    const total = cart.reduce((sum, i) => sum + i.price * i.qty, 0);
    try {
      await db.collection("orders").add({
        user: user.email,
        items: cart,
        total: total,
        date: firebase.firestore.Timestamp.now()
      });
      alert("✅ Order placed successfully!");
      localStorage.removeItem('cart');
      window.location.href = "account.html";
    } catch (err) {
      alert("❌ Error: " + err.message);
    }
  }

  // === Laad-overlay logica ===
  let loadTimeout;
  function showOverlayIfSlow() {
    loadTimeout = setTimeout(() => {
      overlay.style.display = 'flex';
      // Sterren genereren
      const stardust = document.getElementById('stardust');
      for (let i = 0; i < 22; i++) {
        const star = document.createElement('span');
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animationDelay = (Math.random() * 3) + 's';
        star.style.width = star.style.height = (Math.random() * 2 + 1) + 'px';
        stardust.appendChild(star);
      }
    }, 2000); // verschijnt pas na 2s traag laden
  }

  function hideOverlay() {
    clearTimeout(loadTimeout);
    overlay.style.display = 'none';
  }

  document.addEventListener("DOMContentLoaded", () => {
    showOverlayIfSlow();
  });
  window.addEventListener("load", () => {
    hideOverlay();
    renderCart();
  });
</script>
</body>
</html>
